SELECT 
ORDERS.ID AS 'order_id', 
MEMBERS.NAME AS 'name', 
CASE 
WHEN PAYMENT.PAYMENT_METHOD = 'point' THEN 1
WHEN PAYMENT.PAYMENT_METHOD = 'card' THEN 0
END AS 'is_point'
FROM ORDERS
INNER JOIN MEMBERS ON ORDERS.MEMBER_ID = MEMBERS.ID
INNER JOIN ORDER_OPTIONS ON ORDERS.ID = ORDER_OPTIONS.ID
INNER JOIN PAYMENTS ON ORDER_OPTIONS.ID = PAYMENTS.ORDER_OPTION_ID
ORDER BY ORDERS.ID;


---------------------------------------------------------

SELECT
MEMBERS.NAME AS 'member_name',
ROUND(AVG(SUM(PAYMENTS.PRICE)/COUNT(PAYMENTS.ID))) AS 'avg_amount',
COUNT(PAYMENTS.ID) AS 'order_count'
FROM ORDERS
INNER JOIN MEMBERS ON ORDERS.MEMBER_ID = MEMBERS.ID
INNER JOIN ORDER_OPTIONS ON ORDERS.ID = ORDER_OPTIONS.ID
INNER JOIN PAYMENTS ON ORDER_OPTIONS.ID = PAYMENTS.ORDER_OPTION_ID
WHERE DATE(PAYMENTS.CREATED_AT) BETWEEN '2020-12-01' AND '2020-12-31'
GROUP BY MEMBERS.NAME
ORDER BY
ROUND(AVG(SUM(PAYMENTS.PRICE)/COUNT(PAYMENTS.ID))) DESC,
COUNT(PAYMENTS.ID) ASC;